name: Build Minecraft Executable with Forge

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up JDK 8
        run: |
          sudo add-apt-repository ppa:openjdk-r/ppa
          sudo apt-get update
          sudo apt-get install -y openjdk-8-jdk wget

      - name: Download Forge JAR
        run: |
          mkdir -p build/
          wget -O build/1.16.5-Forge.jar https://github.com/fxlgm/j9build/releases/download/nead/1.16.5-Forge.jar

      - name: Download Launch4j
        run: |
          wget -O launch4j.zip https://sourceforge.net/projects/launch4j/files/latest/download
          unzip launch4j.zip -d launch4j
          # Ensure `launch4j` is executable
          chmod +x launch4j/launch4j

      - name: Create Launch4j Configuration
        run: |
          echo '<?xml version="1.0" encoding="UTF-8"?>
          <launch4jconfig>
            <header>
              <image></image>
              <icon></icon>
              <jar>build/minecraft.jar</jar>
              <outfile>build/minecraft.exe</outfile>
              <errTitle>Minecraft</errTitle>
              <cmdLine></cmdLine>
              <chdir></chdir>
              <downloadUrl></downloadUrl>
              <supportUrl></supportUrl>
            </header>
          </launch4jconfig>' > launch4j-config.xml

      - name: Build Executable with Launch4j
        run: |
          launch4j/launch4j launch4j-config.xml

      - name: Upload build artifacts
        uses: actions/upload-artifact@v3
        with:
          name: minecraft-executable
          path: build/minecraft.exe
